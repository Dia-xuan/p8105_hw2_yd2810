---
title: "p8105_hw2_yd2810"
author: "Yaxuan Deng"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readr)
library(dplyr)
library(tidyr)
library(lubridate)
```


## Problem 1

### 1.1

First, clean the data in pols-month.csv. Use separate() to break up the variable mon into integer variables year, month, and day; replace month number with month name; create a president variable taking values gop and dem, and remove prez_dem and prez_gop; and remove the day variable.

```{r}
path_pols <- file.path("data","pols-month.csv")

pols <- read_csv(path_pols) %>% 
  separate(mon, into = c("year", "month", "day"), sep = "-") %>% 
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day)
  ) %>% 
  mutate(month = month.name[month],
         president = case_when(prez_gop != 0 ~ "gop",
                               prez_dem != 0 ~ "dem")) %>% 
  select(year,month,president,everything(),-prez_gop,-prez_dem,-day)
```
### 1.2

Second, clean the data in snp.csv using a similar process to the above. For consistency across datasets, arrange according to year and month, and organize so that year and month are the leading columns.

```{r}
path_snp <- file.path("data", "snp.csv")

snp <- read_csv(path_snp) %>%
  mutate(
    date  = mdy(date),
    year  = year(date),
    month = month.name[month(date)] 
  ) %>%
  select(year, month, close) %>%
  arrange(year, match(month, month.name))
```
### 1.3

Third, tidy the unemployment data so that it can be merged with the previous datasets. This process will involve switching from “wide” to “long” format; ensuring that key variables have the same name; and ensuring that key variables take the same values.

```{r}
path_unem <- file.path("data", "unemployment.csv")

unemp <- read_csv(path_unem) %>% 
  pivot_longer(
    cols = -Year,
    names_to  = "month",  
    values_to = "unemployment"
  ) %>%
  mutate(
    month = month.name[match(month, month.abb)],
    year  = Year
  ) %>%
  select(year, month, unemployment) %>%
  arrange(year, match(month, month.name))
```
### 1.4 merging

Join the datasets by merging snp into pols, and merging unemployment into the result.

```{r}
pols_snp <- left_join(pols,snp,by = c("year","month"))
final <- left_join(pols_snp,unemp,by = c("year","month"))
```

Write a short paragraph about these datasets. Explain briefly what each dataset contained, and describe the resulting dataset (e.g. give the dimension, range of years, and names of key variables):

```{r}
n_obs <- nrow(final)
n_vars <- ncol(final)
y_min <- min(final$year)
y_max <- max(final$year)
```

`pols` contains the information of the number of national politicians who are democratic or republican at any given time. `snp` provides `r nrow(snp)` monthly S&P closing values. `unemp` records U.S. monthly unemployment percentages by year.

The resulting dataset has `r nrow(final)` rows (observations) and `r ncol(final)` variables, covering `r min(final$year)` to `r max(final$year)`. The key variables are `r paste(c("year","month","president","close","unemployment"), collapse = ", ")`.

